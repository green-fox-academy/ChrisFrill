<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link href="/webjars/bootstrap/3.3.7-1/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="/webjars/bootstrap/3.3.7-1/js/bootstrap.min.js"></script>
    <script src="/webjars/jquery/1.11.1/jquery.min.js"></script>
    <title>Title</title>
</head>
<body>
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">ChReddit</a>
        </div>
        <ul class="nav navbar-nav">
            <li class="active"><a href="#">Trending posts</a></li>
            <li><a th:href="@{/submit}">Submit new post</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
            <li>
                <a th:if="${#authentication instanceof T(org.springframework.security.authentication.AnonymousAuthenticationToken)}" href="#" data-toggle="modal"
                   data-target="#registration">
                    <span class="glyphicon glyphicon-user">
                    </span> Sign Up
                </a>
                <!-- Modal -->
                <div class="modal fade" id="registration" tabindex="-1" role="dialog" aria-labelledby="registration"
                     aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <form method="POST" th:action="@{/registration}" th:object="${userForm}"
                                  class="form-signin">
                                <h2 class="form-signin-heading">Create your account</h2>
                                <input th:field="*{username}" type="text" class="form-control" placeholder="Username"
                                       autofocus="true">

                                <input th:field="*{password}" type="password" class="form-control"
                                       placeholder="Password">


                                <input th:field="*{passwordConfirm}" type="password" class="form-control"
                                       placeholder="Confirm your password">

                                <button class="btn btn-lg btn-primary btn-block" type="submit">Submit</button>
                            </form>
                        </div>
                    </div>
                </div>
            </li>
            <li>

                <a th:if="${#authentication instanceof T(org.springframework.security.authentication.AnonymousAuthenticationToken)}" href="#" data-toggle="modal" data-target="#login">
                    <span class="glyphicon glyphicon-log-in">
                    </span> Login
                </a>

                <!-- Modal -->
                <div class="modal fade" id="login" tabindex="-1" role="dialog" aria-labelledby="login"
                     aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <form method="POST" th:action="@{/login}" class="form-signin">
                                <h2 class="form-heading">Log in</h2>

                                <div class="form-group ${error != null ? 'has-error' : ''}">

                                    <input name="username" type="text" class="form-control" placeholder="Username"
                                           autofocus="true"/>
                                    <input name="password" type="password" class="form-control" placeholder="Password"/>

                                    <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>

                                    <button class="btn btn-lg btn-primary btn-block" type="submit">Log In</button>
                                    <h4 class="text-center"><a href="/registration">Create an account</a></h4>
                                </div>

                            </form>
                        </div>
                    </div>
                </div>
            </li>

            <li>

                <a th:if="${!(#authentication instanceof T(org.springframework.security.authentication.AnonymousAuthenticationToken))}" href="#" data-toggle="modal" data-target="#userDetails">
                    <span class="glyphicon glyphicon-user" th:text="' ' + ${#authentication.getName()}">
                    </span>
                </a>

                <!-- Modal -->
                <div class="modal fade" id="userDetails" tabindex="-1" role="dialog" aria-labelledby="userDetailsLabel"
                     aria-hidden="true">
                    <div class="modal-dialog " role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h3 th:text="${#authentication.getName()}" class="modal-title" id="userDetailsLabel">
                                    Modal title</h3>
                            </div>
                            <div class="modal-body">
                                <h4>Posts</h4>
                            </div>
                            <div class="modal-footer">
                                <div class="col-lg-2 pull-right">
                                    <form th:action="@{/logout}" method="post">
                                        <input type="submit" class="btn btn-danger" value="Sign Out"/>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </div>
</nav>

<h1 th:text="${#authentication.getPrincipal()}"></h1>

<div class="container">
    <table class="table table-striped">
        <thead>
        <tr>
            <th scope="col">Likes</th>
            <th scope="col"></th>
            <th scope="col">Title</th>
            <th scope="col">Creation date</th>
            <th scope="col">Author</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="post : ${posts}">
            <th scope="row" class="col-lg-1" th:text="${post.score}"></th>
            <td class="col-lg-2">
                <div class="row">
                    <div class="col-lg-1">
                        <form th:method="POST" th:action="@{upvote}" th:object="${post}">
                            <div class="form-group">
                                <input type="hidden" th:value="${post.id}" th:name="id">
                                <button class="btn btn-primary btn-sm glyphicon glyphicon-thumbs-up" type="submit"
                                        value="Submit"></button>
                            </div>
                        </form>
                    </div>
                    <div class="col-lg-1"></div>
                    <div class="col-lg-1">
                        <form th:method="POST" th:action="@{downvote}" th:object="${post}">
                            <div class="form-group">
                                <input type="hidden" th:value="${post.id}" th:name="id">
                                <button class="btn btn-danger btn-sm glyphicon glyphicon-thumbs-down" type="submit"
                                        value="Submit"></button>
                            </div>
                        </form>
                    </div>
                </div>


            </td>
            <td class="col-lg-6" th:text="${post.title}"></td>
            <td class="col-lg-2" th:text="${#dates.format(post.creationDate, 'dd/MM/yyyy HH:mm:ss')}"></td>
            <td class="col-lg-2"></td>
        </tr>
        </tbody>
    </table>

    <div class="row">
        <div class="pull-right">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-end">
                    <li th:class="${posts.isFirst()}?'disabled':''">
                        <span th:if='${posts.isFirst()}'>← First</span>
                        <a th:if='${not posts.isFirst()}' th:href='@{/(page=1)}'>←
                            First</a>
                    </li>
                    <li th:class="${posts.hasPrevious()}? '' : 'disabled'">
                        <span th:if='${not posts.hasPrevious()}'>«</span>
                        <a th:if='${posts.hasPrevious()}'
                           th:href='@{/(page=${page - 1})}'
                           title='Go to previous page'>«</a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0,posts.totalPages)}"
                        th:class="${posts.number == i - 1}? 'active' : ''">
                        <a th:if="${i} >= 1" th:href="@{/(page=${i})}" th:text="${i}" class="page-link"></a>
                    </li>
                    <li th:class="${posts.hasNext()}? '' : 'disabled'">
                        <span th:if='${not posts.hasNext()}'>»</span>
                        <a th:if='${posts.hasNext()}'
                           th:href='@{/(page=${page + 1})}'
                           title='Go to next page'>»</a>
                    </li>
                    <li th:class="${posts.isLast()}?'disabled':''">
                        <span th:if='${posts.isLast()}'>Last →</span>
                        <a th:if='${not posts.isLast()}' th:href='@{/(page=${posts.totalPages-1})}'>Last →</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

</div>
<a href ="#" id="load_home"> HOME </a>
<div id="content"></div>


<script>
    $(document).ready( function() {
        $("#load_home").on("click", function() {
            $("#content").load("/login");
        });
    });
</script>
</body>
</html>